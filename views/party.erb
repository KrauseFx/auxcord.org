<h3>Jukebox for Sonos - Party Host</h3>

<h4>Generated URL</h4>
<p><a href="<%= @party_join_link %>"><%= @party_join_link %></a></p>
<%= @qr_code.as_svg(
  color: "000",
  shape_rendering: "crispEdges",
  module_size: 4,
  standalone: true,
  use_path: true,
)
%>

<h4>Song Queue</h4>

<ol>
  <% @queued_songs.each do |song| %>
    <li><%= song.name %></li>
  <% end %>
</ol>

<h4>Manage Party</h4>

<button class="button button3" onclick="skipSong()">Skip song</button>

<h5>Volume Control</h5>

<button class="button button3" onclick="volumeDown()">Volume Down</button>
<button class="button button3" onclick="volumeUp()">Volume Up</button>

<div class="slidecontainer">
  <input type="range" min="1" max="100" value="<%= @volume %>" class="slider" id="volume-slider">
  <span id="volume-label"><%= @volume %></span>
</div>

<h5>Groups</h5>
<div id="groupsDiv">
  <% @groups.each do |group| %>
    <label class="container"><%= group[:name] %> (<%= group[:number_of_speakers] %> <%= group[:number_of_speakers] == 1 ? "speaker" : "speakers" %>)
      <input value="<%= group[:id] %>" type="radio" name="group" onclick="updateGroup()" <%= @selected_group == group[:id] ? 'checked="checked"' : '' %>>
      <span class="checkmark"></span>
    </label>
  <% end %>
</div>

<h5>End this party</h5>

Ready to head out for the night? Stop the party<br /><br />

<label class="switch">
  <input type="checkbox" id="party-toggle" <%= @party_on ? 'checked="checked"' : '' %>%>
  <span class="switch-slider round"></span>
</label>

<script type="text/javascript">
  // Send the updated volume slider value to the server
  var slider = document.getElementById("volume-slider");
  slider.onchange = function() {
    document.getElementById("volume-label").innerHTML = slider.value;
    var xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/party/host/update", true);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send("volume=" + slider.value);
  }

  var partyToggle = document.getElementById("party-toggle");
  partyToggle.onchange = function() {
    var xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/party/host/update", true);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send("party_toggle=" + partyToggle.checked);
  }

  function updateGroup() {
    // Get the currently selected group
    var groupToUse = document.querySelector('input[name="group"]:checked').value;
    var xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/party/host/update", true);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send("group_to_use=" + groupToUse);
  }
  function volumeUp() {
    var slider = document.getElementById("volume-slider");
    slider.value = parseInt(slider.value) + 5;
    slider.onchange();
  }
  function volumeDown() {
    var slider = document.getElementById("volume-slider");
    slider.value = parseInt(slider.value) - 5;
    slider.onchange();
  }
  function skipSong() {
    var xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/party/host/update", true);
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    xhttp.send("skip_song=true");
  }
</script>

<style type="text/css">
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  }
  #volume-slider {
    width: 300px;
    margin: 20px;
  }
  #volume-label {
    font-weight: bold;
    font-size: 20px;
  }
</style>
